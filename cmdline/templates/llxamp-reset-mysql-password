#!/bin/bash
pass="$1"
export $(llxamp-status -m)
if [ "x$MYSQL_RUNNING" == "x1" ];then
    llxamp-stop-mysql
    sleep 1
    llxamp-kill-mysql
fi
@@LLXAMP_BASEPATH@@/mysql/bin/mysqld --defaults-file=@@LLXAMP_BASEPATH@@/mysql/conf/my.cnf --skip-grant-tables > /dev/null 2>&1 &
while ! @@LLXAMP_BASEPATH@@/mysql/bin/mysql --defaults-file=@@LLXAMP_BASEPATH@@/mysql/conf/my.cnf --user=root -e 'status' 2>/dev/null; do
    sleep 1;
done;
@@LLXAMP_BASEPATH@@/mysql/bin/mysql --defaults-file=@@LLXAMP_BASEPATH@@/mysql/conf/my.cnf --user=root -e \"UPDATE mysql.user SET Password = PASSWORD('\$pass') WHERE User = 'root';FLUSH PRIVILEGES;\"
kill $(cat @@LLXAMP_BASEPATH@@/mysql/temp/mysql.pid)
if [ "x$MYSQL_RUNNING" == "x1" ];then
    llxamp-start-mysql
fi